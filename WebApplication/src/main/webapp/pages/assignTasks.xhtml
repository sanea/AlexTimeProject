<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core">
<h:body>
    <ui:composition template="templates/template.xhtml">
        <ui:define name="content">
            <h2><h:outputText value="#{msg['assign.tasks.title']}"/></h2>
            <h:form id="contentForm">
                <h:panelGrid columns="3" styleClass="w100"
                             columnClasses="w333 valign-top, w333 valign-top, w333 valign-top" rowClasses="">
                    <h:panelGroup>
                        <p:dataTable var="site" value="#{assignTasksEditMB.siteList}" id="siteTable"
                                     rowKey="#{site.id}" selectionMode="single"
                                     selection="#{assignTasksEditMB.selectedSite}">

                            <p:ajax event="rowSelect" listener="#{assignTasksEditMB.onSiteRowSelect}"
                                    update=":contentForm:taskList :contentForm:userList"
                                    onstart="blockTaskTable.show(); blockUserTable.show();"
                                    oncomplete="blockTaskTable.hide(); blockUserTable.hide();"/>
                            <p:ajax event="rowUnselect" listener="#{assignTasksEditMB.onSiteRowUnselect}"
                                    update=":contentForm:taskList :contentForm:userList"
                                    onstart="blockTaskTable.show(); blockUserTable.show();"
                                    oncomplete="blockTaskTable.hide(); blockUserTable.hide();"/>

                            <f:facet name="header">
                                <h:outputText value="#{msg['assign.tasks.site.list']}"/>
                            </f:facet>

                            <p:column headerText="#{msg['name']}" sortBy="#{site.name}" styleClass="td-center">
                                <h:outputText value="#{site.name}"/>
                            </p:column>

                        </p:dataTable>
                    </h:panelGroup>

                    <h:panelGroup id="taskList">
                        <p:dataTable var="task" value="#{assignTasksEditMB.assignedTaskList}" id="taskTable"
                                     emptyMessage="#{msg['assign.tasks.task.list.empty.mess']}"
                                     rowKey="#{task.task.id}" selectionMode="single"
                                     selection="#{assignTasksEditMB.selectedTask}">

                            <p:ajax event="rowSelect" listener="#{assignTasksEditMB.onTaskRowSelect}"
                                    update=":contentForm:userList"
                                    onstart="blockTaskTable.show(); blockUserTable.show();"
                                    oncomplete="blockTaskTable.hide(); blockUserTable.hide();"/>
                            <p:ajax event="rowUnselect" listener="#{assignTasksEditMB.onTaskRowUnselect}"
                                    update=":contentForm:userList"
                                    onstart="blockTaskTable.show(); blockUserTable.show();"
                                    oncomplete="blockTaskTable.hide(); blockUserTable.hide();"/>

                            <f:facet name="header">
                                <h:outputText value="#{msg['assign.tasks.task.list']}"/>
                            </f:facet>

                            <p:column headerText="#{msg['name']}" sortBy="#{task.task.name}" styleClass="td-center">
                                <h:outputText value="#{task.task.name}"/>
                            </p:column>

                            <p:column styleClass="td-center w1" headerText="Assign">
                                <p:selectBooleanCheckbox value="#{task.selected}" disabled="#{task.disabled}">
                                    <p:ajax update=":contentForm:taskList :contentForm:userList"
                                            listener="#{assignTasksEditMB.assignTask}"
                                            onstart="blockTaskTable.show(); blockUserTable.show();"
                                            oncomplete="blockTaskTable.hide(); blockUserTable.hide();"/>
                                    <f:attribute name="task" value="#{task}"/>
                                </p:selectBooleanCheckbox>
                            </p:column>

                        </p:dataTable>
                        <p:blockUI block="taskTable" widgetVar="blockTaskTable">
                            <p:graphicImage value="#{resource['images/loading.gif']}" styleClass="ajax-loading-img"/>
                        </p:blockUI>
                    </h:panelGroup>

                    <h:panelGroup id="userList">
                        <p:dataTable var="user" value="#{assignTasksEditMB.assignedUserList}" id="userTable"
                                     emptyMessage="#{msg['assign.tasks.user.list.empty.mess']}">

                            <f:facet name="header">
                                <h:outputText value="#{msg['assign.tasks.user.list']}"/>
                            </f:facet>

                            <p:column headerText="#{msg['name']}" sortBy="#{user.user.username}" styleClass="td-center">
                                <h:outputText value="#{user.user.username}"/>
                            </p:column>

                            <p:column styleClass="td-center w1" headerText="Assign">
                                <p:selectBooleanCheckbox value="#{user.selected}" disabled="#{user.disabled}">
                                    <p:ajax update=":contentForm:userList"
                                            listener="#{assignTasksEditMB.assignUser}"
                                            onstart="blockUserTable.show();"
                                            oncomplete="blockUserTable.hide();"/>
                                    <f:attribute name="user" value="#{user}"/>
                                </p:selectBooleanCheckbox>
                            </p:column>

                        </p:dataTable>
                        <p:blockUI block="userTable" widgetVar="blockUserTable">
                            <p:graphicImage value="#{resource['images/loading.gif']}" styleClass="ajax-loading-img"/>
                        </p:blockUI>
                    </h:panelGroup>
                </h:panelGrid>
            </h:form>
        </ui:define>
    </ui:composition>
</h:body>
</html>